{# 
  SECTION SERVICES MODULAIRE
  ========================
  
  Cette macro g√©n√®re la section "Nos Services" avec diff√©rentes variantes d'affichage.
  
  PARAM√àTRES:
  - identity: Donn√©es personnalis√©es du client (depuis Tally)
  - defaults: Placeholders par m√©tier (depuis trades.json)
  - variant: Type d'affichage ("grid", "carousel", "list")
  - data: Services √† afficher (calcul√© automatiquement avec fallback)
  
  SYST√àME DE FALLBACK:
  Si identity.services est vide ‚Üí utilise defaults.services
  Garantit qu'aucune section ne sera jamais vide !
  
  VARIANTES DISPONIBLES:
  - grid: Grille de cartes (d√©faut)
  - carousel: D√©filement horizontal avec scroll-snap
  - list: Liste simple verticale
#}

{% macro Services(identity, defaults, variant, data) %}
  {# 
    CALCUL DES DONN√âES AVEC FALLBACK
    Si le client n'a pas personnalis√© ses services via Tally,
    on utilise les placeholders du m√©tier (serrurier/d√©panneur/√©lectricien)
  #}
  {% set servicesList = data or identity.services or defaults.services %}
  
  {# 
    VALIDATION: S'assurer qu'on a des donn√©es √† afficher
    Cette v√©rification √©vite les sections vides
  #}
  {% if servicesList and servicesList.length > 0 %}
    <section id="services" class="section section--services">
      {# EN-T√äTE DE SECTION #}
      <header class="section__header">
        <h2 class="section__title">
          üîß Nos Services
        </h2>
        <p class="section__subtitle">
          {# Personnalisation avec nom d'entreprise et ville si disponibles #}
          {{ identity.BUSINESS_NAME or identity.brandName or "Votre expert" }} ‚Äî 
          {{ identity.CITY or identity.city or "Votre ville" }}
        </p>
      </header>

      {# 
        VARIANTE GRID (Grille de cartes)
        Affichage par d√©faut, responsive, adapt√© pour 2-4 services
      #}
      {% if variant == "grid" %}
        <div class="services-grid">
          {% for service in servicesList %}
            <article class="service-card" data-service="{{ loop.index }}">
              {# Ic√¥ne automatique bas√©e sur le titre du service #}
              <div class="service-icon">
                {% if "ouverture" in service.title | lower %}üîì
                {% elif "d√©pannage" in service.title | lower or "batterie" in service.title | lower %}üîã
                {% elif "remorquage" in service.title | lower %}üöõ
                {% elif "√©lectrique" in service.title | lower or "√©lectricien" in service.title | lower %}‚ö°
                {% elif "serrure" in service.title | lower or "cylindre" in service.title | lower %}üîê
                {% else %}üõ†Ô∏è{% endif %}
              </div>
              <h3 class="service-title">{{ service.title }}</h3>
              <p class="service-description">{{ service.desc }}</p>
              {# Prix si disponible dans les donn√©es #}
              {% if service.price %}
                <div class="service-price">{{ service.price }}</div>
              {% endif %}
            </article>
          {% endfor %}
        </div>

      {# 
        VARIANTE CAROUSEL (D√©filement horizontal)
        Id√©al pour mobile, permet de voir plus de services
        Utilise scroll-snap CSS (pas de JS n√©cessaire)
      #}
      {% elif variant == "carousel" %}
        <div class="services-carousel" tabindex="0">
          <div class="carousel-track">
            {% for service in servicesList %}
              <article class="service-card service-card--carousel" data-service="{{ loop.index }}">
                <div class="service-icon">
                  {% if "ouverture" in service.title | lower %}üîì
                  {% elif "d√©pannage" in service.title | lower or "batterie" in service.title | lower %}üîã
                  {% elif "remorquage" in service.title | lower %}üöõ
                  {% elif "√©lectrique" in service.title | lower %}‚ö°
                  {% elif "serrure" in service.title | lower %}üîê
                  {% else %}üõ†Ô∏è{% endif %}
                </div>
                <h3 class="service-title">{{ service.title }}</h3>
                <p class="service-description">{{ service.desc }}</p>
                {% if service.price %}
                  <div class="service-price">{{ service.price }}</div>
                {% endif %}
              </article>
            {% endfor %}
          </div>
          {# Indication visuelle pour le scroll #}
          <div class="carousel-hint">‚Üê Glissez pour voir plus ‚Üí</div>
        </div>

      {# 
        VARIANTE LIST (Liste simple)
        Affichage compact, id√©al pour beaucoup de services
        Prend moins d'espace vertical
      #}
      {% elif variant == "list" %}
        <ul class="services-list">
          {% for service in servicesList %}
            <li class="service-item" data-service="{{ loop.index }}">
              <div class="service-content">
                <strong class="service-title">{{ service.title }}</strong>
                <span class="service-separator">‚Äî</span>
                <span class="service-description">{{ service.desc }}</span>
                {% if service.price %}
                  <span class="service-price">({{ service.price }})</span>
                {% endif %}
              </div>
            </li>
          {% endfor %}
        </ul>

      {# 
        FALLBACK: Si variante inconnue, utiliser grid par d√©faut
        √âvite les erreurs si on passe une variante non support√©e
      #}
      {% else %}
        {# R√©cursion avec variante par d√©faut #}
        {{ Services(identity, defaults, "grid", servicesList) }}
      {% endif %}

      {# 
        CALL-TO-ACTION (optionnel)
        Bouton d'action si num√©ro de t√©l√©phone disponible
      #}
      {% if identity.PHONE or identity.phone %}
        <div class="services-cta">
          <a href="tel:{{ identity.PHONE or identity.phone }}" class="btn btn--primary">
            üìû Appelez maintenant : {{ identity.PHONE or identity.phone }}
          </a>
        </div>
      {% endif %}
    </section>
  {% endif %}
{% endmacro %}
